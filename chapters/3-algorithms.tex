\chapter{Algorithms}\label{chap:algorithms}
In the following the three load balancing algorithms under test are presented. Firstly, the classic Push-Pull Sum algorithm and the Contiunous Single-Proposal Deal-Agreement-Based Algorithm are introduces. The novel algorithm that is proposed in this paper, the Adaptive Threshold Push-Pull Sum algorithm is then introduced, and it is depicted how the algorithm is composed of the other two algorithms, and why the protocol is composed like that. For all algorithms the pseudo-code and a description of how the algorithms work is presented. Furthermore, example are provided to enhance the understanding of how the algorithms balance load. For the Adaptive Threshold Push-Pull Sum Protocol additionaly the aspired outcome is presented.

\section{Classic Push-Pull Sum Protocol}\label{sec:classicPPS}
The Push-Pull Sum algorithm as proposed in \cite{nugroho2023PushPullSumDataAg} requires each node to have sum $s_{i,r}$ and weight $w_{i,r}$ values as information. The initial weight $w_{i,0}$ for each node is equal to 1. The sum of all weights is equal to the network size $N$. The sum of $s_{i,0}$ is equal to whatever the required input $x_i \in \mathbb{R}^{+}_{0}$ is, in the paper the values for the sums are uniformly distributed values between 0 and 100 \cite{nugroho2023PushPullSumDataAg}. The pseudo code is to be found in figure \ref{alg:PPS}. The Push-Pull Sum algorithm is composed of three different procedures, namely the \textit{RequestData} procedure, the \textit{ResponseData} procedure and the \textit{Aggregate} procedure. In every round $r$ the \textit{Aggregate} procedure is called, except for the first round, since there is no information to be aggregated. In this procedure, every node gatheres all incoming messages $M{node,r}$ sent by other nodes $\{(s_m, w_m)\}$ in the previous round $r-1$, requesting data. Also, nodes update their sum values which essentially is $\sum_{m \in M_{node,r}}{s_m}$ and weight values $\sum_{m \in M_{node,r}}{w_m}$. And finally these values are form the respective load values by dividing sum by weight. Following that, each node calls the \textit{RequestData} procedure. In this procedure, each node chooses a random neighbor node and sends half of its sum $\frac{s_{node,r}}{2}$ and half of its weight $\frac{w_{node,r}}{2}$ to the chosen node and itself. This is the push mechanism. The pull mechanism is described in the \textit{ResponseData} procedure. Here, each node gathers the incoming requests per round $r$ in a set $R_{node, r}$. Then, each node replies to each requesting node (including itself) with the half of its sum value divided by the number of incoming requests, so $\frac{\frac{s_{node,r}}{2}}{|R_{node, r}|}$.

\input{figures/pseudoalgos/classicPPS.tex}

The Push-Pull Sum algorithm has the mass-conservation property \cite{nugroho2023PushPullSumDataAg}. This property ensures that the values will converge to the same value but not the correct aggregate of the ground truth. They converge to the true mean. The setting in that paper is similar to ours. While they only inspect a complete graph with $10^{4}$ nodes, we have network sizes of $2^{10}$ nodes and more topologies under test. 50 experiments each conducted for 30 rounds were performed. The paper showed that the Push-Pull Sum protocol decreases the expected potential $\Phi_r$ exponentially. The potential function is defined as $\Phi_t=\sum_{i,j}\left(v_{i,j,r}-\frac{w_{i,r}}{n}\right)^{2}$. The $v_{i,j,r}$ component stores the fractional value of node $j$'s contribution at round $r$. The conditional expectation of $\Phi_r+1$ for the Push-Pull Sum protocol is $\mathbb{E}[\Phi_r+1|\Phi_r=\phi]=(\frac{2e-1}{4e}-\frac{1}{4n})\phi$ \cite{nugroho2023PushPullSumDataAg}.

\subsection{Example}\label{subsec:examplePPS}

\section{Contiunous Single-Proposal Deal-Agreement-Based Protocol}\label{sec:singleproposalDAB}
The Continuous Single-Proposal Algorithm Deal-Agreement-Based algorithm proposed by \cite{Dinitz2023DAB}, is unlike the Push-Pull Sum protocol not an diffusion-based load balancing algorithm. The goal of load balancing is achieved based on deterministic deal-agreements, where one node proposes node to one neighboring node and the neighboring node either accepts transfer proposal in either full or partialy. Dinitz et al. algorithm is a anytime algorithm, as they never the worsen the state of the network during execution. They can be stopped at \textit{any time} of the execution. They studied the algorithm in a dynamic setting, which means that the graph may experience changes between rounds. Furthermore, the algorithm is a localized one, where the nodes only work with the information regarding the load state of themselves and their neighbors load state. Each node has a set of neighboring nodes and their including the node's initial load itself as initial information. The algorithm is divided into three phases. There is the \textit{proposal}, \textit{deal} and the \textit{summary}-phase. In the \textit{proposal}-phase each node $u$ contacts the minimal loaded neighbor \textit{v} and sends a proposal to that neighbor, if the neighbor is less loaded. The proposal is of value $(\frac{load_{r}(u)-load_{r}(v)}{2})$, which is labeled as a \textit{fair} proposal. Since the load transfer is fair, the resulting load of $u$ is not lower than that of $v$. Following that, the nodes enter the \textit{deal}-phase. In this phase nodes evaluate the deals proposed to them. A node accepts the deal of the node that proposes the maximal load transfer. The actual transfer happens and the load values are being updated. Finally, in the \textit{summary}-phase each node informs their neighbors regarding their updated load values. \cite{Dinitz2023DAB}
\input{figures/pseudoalgos/DAB.tex}
The analysis in this paper is based on a potential function. Dinitz et al. defines potential for a node $u$ as $p(u) = (load(u)-L_{avg})^{2}$ where $L_{avg}$ is the current load average in the network. The potential for the Graph $p(G)$ is defined as $p(G)=\sum_{u\in V}{p(u)}$, which essentially is the sum of all potential of each node in the graph G. Any fair load transfer of load $l$ decreases the potential of the graph by at least $2*l^{2}$. And as a result of any round $r$ of the Contiunous Single-Proposal Deal-Agreement-Based Protocol, the graph potential decreases by at least $\frac{K^{2}_r}{2D_r}$ where $K$ is the initial discrepancy and $D$ is a bound for the graph diameter. \cite{Dinitz2023DAB}
\subsection{Example}\label{subsec:exampleDAB}
\todo{See section 1.1 of Dinitz paper to describe to methods of load balancing fot the DAB.}

\section{Adaptive Threshold Push-Pull Sum Protocol}\label{sec:adaptivethresholdPPS}
\input{figures/pseudoalgos/adaptiveThresholdPPS.tex}
\subsection{Example}\label{subsec:exampleAdaptiveThresholdPPS}
\subsection{Aspired Outcome}\label{subsec:aspiredOutcomeAdaptiveThresholdPPS}